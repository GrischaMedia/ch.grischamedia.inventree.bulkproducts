<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ plugin_title }} - InvenTree</title>
  <link rel="stylesheet" href="/static/plugins/bulkproducts/bulkproducts/style.css">
</head>
<body>
  <div class="page">
    <div class="topbar">
      InvenTree - {{ plugin_title }}
    </div>

    <div class="container">
      <div class="card">
        <div class="card-header">
          <h1 class="card-title">{{ plugin_title }}</h1>
        </div>

        <div class="card-body">
          <form class="d-none">{% csrf_token %}</form>

          <div id="bp-alert" class="alert d-none" role="alert"></div>

          <div class="table-responsive">
            <table class="table table-sm table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th style="width: 40px;" class="text-center"></th>
                  <th style="min-width: 220px;">Kategorie *</th>
                  <th style="min-width: 220px;">Name *</th>
                  <th style="min-width: 260px;">Beschreibung</th>
                  <th style="min-width: 180px;">IPN</th>
                  <th style="width: 140px;">Anzahl</th>
                  <th style="min-width: 260px;">Lagerort</th>
                  <th style="width: 90px;" class="text-end">Aktion</th>
                </tr>
              </thead>
              <tbody id="bp-rows"></tbody>
            </table>
          </div>

          <div class="d-flex gap-2 mt-3">
            <button type="button" class="btn btn-primary" id="bp-add-row">
              <i class="fas fa-plus"></i> Hinzufügen
            </button>
            <button type="button" class="btn btn-outline-secondary" id="bp-reset">
              <i class="fas fa-redo"></i> Zurücksetzen
            </button>
          </div>

          <hr class="my-4" />

          <div class="d-flex justify-content-end mb-3">
            <button type="button" class="btn btn-success btn-lg" id="bp-submit">
              <i class="fas fa-check"></i> Teile Erstellen / Einbuchen
            </button>
          </div>

          <h5 class="mb-3">Ergebnis</h5>
          <div id="bp-result" class="small text-muted mb-3">Noch keine Aktion ausgeführt.</div>

          <div id="bp-created-parts" class="mt-3 d-none">
            <h5 class="mb-3">Erstellte Produkte</h5>
            <div class="list-group" id="bp-parts-list"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="io-footer" style="margin-top:20px; text-align:center; font-size:0.85em; color:#666;">
    © 2025 GrischaMedia.ch – <a href="https://github.com/GrischaMedia/ch.grischamedia.inventree.bulkproducts" target="_blank">GitHub Repository</a>
  </footer>

  <script>
    window.BULKPRODUCTS = {
      csrf: '{{ csrf_token }}',
      categories: [
        {% for c in categories %}
          { id: {{ c.id }}, label: "{{ c.pathstring|default:c.name|escapejs }}" },
        {% endfor %}
      ],
      defaultLocationId: {{ default_location_id|default:0 }},
      apiUrl: "{% url 'plugin:bulk-products:api-bulk-create' %}",
      searchLocationsUrl: "{% url 'plugin:bulk-products:api-search-locations' %}",
      createdParts: [],
      locationSearchTimeouts: new Map()
    };
  </script>
  <script src="/static/plugins/bulkproducts/bulkproducts/script.js"></script>
</body>
</html>
